{
    "file": "force-link",
    "decompiled_code": {
        "force-link.c": [
            {
                "func_name": "samedir_template",
                "func_c_signature": "void * samedir_template(void *param_1,void *param_2)",
                "decompiled_code": "void * samedir_template(void *param_1,void *param_2) {\n  long lVar1;\n  ulong __size;\n  undefined8 *puVar2;\n  void *local_20;\n  \n  lVar1 = last_component(param_1);\n  __size = (lVar1 - (long)param_1) + 9;\n  local_20 = param_2;\n  if ((__size < 0x101) || (local_20 = malloc(__size), local_20 != (void *)0x0)) {\n    puVar2 = (undefined8 *)mempcpy(local_20,param_1,lVar1 - (long)param_1);\n    *puVar2 = simple_pattern;\n    *(undefined *)(puVar2 + 1) = DAT_001004c0;\n  }\n  return local_20;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "samedir_template",
                        "last_component",
                        "malloc",
                        "mempcpy"
                    ],
                    "calling_functions": [
                        "samedir_template",
                        "force_linkat",
                        "force_symlinkat"
                    ],
                    "defined_in_file": "force-link_decompiled.c"
                }
            },
            {
                "func_name": "try_link",
                "func_c_signature": "void try_link(char *param_1,int *param_2)",
                "decompiled_code": "void try_link(char *param_1,int *param_2) {\n  linkat(*param_2,*(char **)(param_2 + 2),param_2[4],param_1,param_2[5]);\n  return;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "try_link",
                        "linkat"
                    ],
                    "calling_functions": [
                        "try_link"
                    ],
                    "defined_in_file": "force-link_decompiled.c"
                }
            },
            {
                "func_name": "force_linkat",
                "func_c_signature": "int force_linkat(int param_1,char *param_2,int param_3,char *param_4,int param_5,char param_6,\n                int param_7)",
                "decompiled_code": "int force_linkat(int param_1,char *param_2,int param_3,char *param_4,int param_5,char param_6,\n                int param_7) {\n  int iVar1;\n  int *piVar2;\n  char *__old;\n  long in_FS_OFFSET;\n  int local_144;\n  int local_138 [2];\n  char *local_130;\n  int local_128;\n  int local_124;\n  char local_118 [264];\n  long local_10;\n  \n  local_10 = *(long *)(in_FS_OFFSET + 0x28);\n  if (param_7 < 0) {\n    iVar1 = linkat(param_1,param_2,param_3,param_4,param_5);\n    if (iVar1 == 0) {\n      param_7 = 0;\n    }\n    else {\n      piVar2 = __errno_location();\n      param_7 = *piVar2;\n    }\n  }\n  if ((param_6 == '\\x01') && (param_7 == 0x11)) {\n    __old = (char *)samedir_template(param_4,local_118);\n    if (__old == (char *)0x0) {\n      piVar2 = __errno_location();\n      param_7 = *piVar2;\n    }\n    else {\n      local_138[0] = param_1;\n      local_130 = param_2;\n      local_128 = param_3;\n      local_124 = param_5;\n      iVar1 = try_tempname_len(__old,0,local_138,try_link,6);\n      if (iVar1 == 0) {\n        iVar1 = renameat(param_3,__old,param_3,param_4);\n        if (iVar1 == 0) {\n          local_144 = -1;\n        }\n        else {\n          piVar2 = __errno_location();\n          local_144 = *piVar2;\n        }\n        unlinkat(param_3,__old,0);\n      }\n      else {\n        piVar2 = __errno_location();\n        local_144 = *piVar2;\n      }\n      param_7 = local_144;\n      if (__old != local_118) {\n        free(__old);\n      }\n    }\n  }\n  if (local_10 == *(long *)(in_FS_OFFSET + 0x28)) {\n    return param_7;\n  }\n                    /* WARNING: Subroutine does not return */\n  __stack_chk_fail();\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "force_linkat",
                        "linkat",
                        "__errno_location",
                        "samedir_template",
                        "try_tempname_len",
                        "renameat",
                        "unlinkat",
                        "free",
                        "__stack_chk_fail"
                    ],
                    "calling_functions": [
                        "force_linkat"
                    ],
                    "defined_in_file": "force-link_decompiled.c"
                }
            },
            {
                "func_name": "try_symlink",
                "func_c_signature": "void try_symlink(char *param_1,char **param_2)",
                "decompiled_code": "void try_symlink(char *param_1,char **param_2) {\n  symlinkat(*param_2,*(int *)(param_2 + 1),param_1);\n  return;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "try_symlink",
                        "symlinkat"
                    ],
                    "calling_functions": [
                        "try_symlink"
                    ],
                    "defined_in_file": "force-link_decompiled.c"
                }
            },
            {
                "func_name": "force_symlinkat",
                "func_c_signature": "int force_symlinkat(char *param_1,int param_2,char *param_3,char param_4,int param_5)",
                "decompiled_code": "int force_symlinkat(char *param_1,int param_2,char *param_3,char param_4,int param_5) {\n  int iVar1;\n  int *piVar2;\n  char *__old;\n  long in_FS_OFFSET;\n  int local_154;\n  int local_134;\n  char *local_128;\n  int local_120;\n  char local_118 [264];\n  long local_10;\n  \n  local_10 = *(long *)(in_FS_OFFSET + 0x28);\n  local_154 = param_5;\n  if (param_5 < 0) {\n    iVar1 = symlinkat(param_1,param_2,param_3);\n    if (iVar1 == 0) {\n      local_154 = 0;\n    }\n    else {\n      piVar2 = __errno_location();\n      local_154 = *piVar2;\n    }\n  }\n  if ((param_4 == '\\x01') && (local_154 == 0x11)) {\n    __old = (char *)samedir_template(param_3,local_118);\n    if (__old == (char *)0x0) {\n      piVar2 = __errno_location();\n      local_154 = *piVar2;\n    }\n    else {\n      local_128 = param_1;\n      local_120 = param_2;\n      iVar1 = try_tempname_len(__old,0,&local_128,try_symlink,6);\n      if (iVar1 == 0) {\n        iVar1 = renameat(param_2,__old,param_2,param_3);\n        if (iVar1 == 0) {\n          local_134 = -1;\n        }\n        else {\n          piVar2 = __errno_location();\n          local_134 = *piVar2;\n          unlinkat(param_2,__old,0);\n        }\n      }\n      else {\n        piVar2 = __errno_location();\n        local_134 = *piVar2;\n      }\n      local_154 = local_134;\n      if (__old != local_118) {\n        free(__old);\n      }\n    }\n  }\n  if (local_10 == *(long *)(in_FS_OFFSET + 0x28)) {\n    return local_154;\n  }\n                    /* WARNING: Subroutine does not return */\n  __stack_chk_fail();\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "force_symlinkat",
                        "symlinkat",
                        "__errno_location",
                        "samedir_template",
                        "try_tempname_len",
                        "renameat",
                        "unlinkat",
                        "free",
                        "__stack_chk_fail"
                    ],
                    "calling_functions": [
                        "force_symlinkat"
                    ],
                    "defined_in_file": "force-link_decompiled.c"
                }
            }
        ]
    }
}