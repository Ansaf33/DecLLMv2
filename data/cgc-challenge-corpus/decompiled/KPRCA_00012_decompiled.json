{
    "file": "KPRCA_00012",
    "decompiled_code": {
        "main.c": [
            {
                "func_name": "read_n",
                "func_c_signature": "int read_n(undefined4 param_1,int param_2,uint param_3)",
                "decompiled_code": "int read_n(undefined4 param_1,int param_2,uint param_3) {\n  int iVar1;\n  int local_18;\n  int local_14;\n  uint local_10;\n  \n  local_14 = param_2;\n  for (local_10 = 0; local_10 < param_3; local_10 = local_10 + 1) {\n    iVar1 = receive(param_1,local_14,1,&local_18);\n    if ((iVar1 != 0) || (local_18 == 0)) break;\n    local_14 = local_14 + 1;\n  }\n  return local_14 - param_2;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "read_n",
                        "receive"
                    ],
                    "calling_functions": [
                        "read_n",
                        "parse_input"
                    ],
                    "defined_in_file": "KPRCA_00012_decompiled.c"
                }
            },
            {
                "func_name": "readuntil",
                "func_c_signature": "int readuntil(undefined4 param_1,char *param_2,uint param_3,char param_4)",
                "decompiled_code": "int readuntil(undefined4 param_1,char *param_2,uint param_3,char param_4) {\n  char *pcVar1;\n  char cVar2;\n  int iVar3;\n  int local_18;\n  char *local_14;\n  uint local_10;\n  \n  local_14 = param_2;\n  local_10 = 0;\n  while ((((local_10 < param_3 && (iVar3 = receive(param_1,local_14,1,&local_18), iVar3 == 0)) &&\n          (local_18 != 0)) &&\n         (pcVar1 = local_14 + 1, cVar2 = *local_14, local_14 = pcVar1, param_4 != cVar2))) {\n    local_10 = local_10 + 1;\n  }\n  local_14[-1] = '\\0';\n  return (int)local_14 - (int)param_2;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "readuntil",
                        "receive"
                    ],
                    "calling_functions": [
                        "readuntil"
                    ],
                    "defined_in_file": "KPRCA_00012_decompiled.c"
                }
            },
            {
                "func_name": "cleanup_input",
                "func_c_signature": "void cleanup_input(void *param_1)",
                "decompiled_code": "void cleanup_input(void *param_1) {\n  if (param_1 != (void *)0x0) {\n    if (*(int *)((int)param_1 + 8) != 0) {\n      free_pkk(*(undefined4 *)((int)param_1 + 8));\n    }\n    if (*(int *)((int)param_1 + 0x10) != 0) {\n      free(*(void **)((int)param_1 + 0x10));\n    }\n    free(param_1);\n  }\n  return;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "cleanup_input",
                        "free_pkk",
                        "free"
                    ],
                    "calling_functions": [
                        "cleanup_input",
                        "parse_input",
                        "main"
                    ],
                    "defined_in_file": "KPRCA_00012_decompiled.c"
                }
            },
            {
                "func_name": "parse_input",
                "func_c_signature": "int * parse_input(void)",
                "decompiled_code": "int * parse_input(void) {\n  int iVar1;\n  void *pvVar2;\n  uint uVar3;\n  undefined4 uVar4;\n  undefined2 local_1e;\n  int local_1c;\n  void *local_18;\n  int *local_14;\n  int local_10;\n  \n  uVar4 = 0x11164;\n  local_14 = (int *)0x0;\n  local_10 = 0;\n  local_14 = (int *)malloc(0x14);\n  if (((local_14 != (int *)0x0) && (iVar1 = read_n(0,&local_1c,4,uVar4), iVar1 == 4)) &&\n     (local_1c == -0x27948b2f)) {\n    local_10 = local_10 + 4;\n    iVar1 = read_n(0,&local_1c,4,uVar4);\n    if (iVar1 == 4) {\n      local_10 = local_10 + 4;\n      *local_14 = local_1c;\n      iVar1 = read_n(0,&local_1c,4,uVar4);\n      if ((iVar1 == 4) && (local_1c == 0x3259036)) {\n        local_10 = local_10 + 4;\n        iVar1 = read_n(0,&local_1c,4,uVar4);\n        if (iVar1 == 4) {\n          local_10 = local_10 + 4;\n          local_14[1] = local_1c;\n          if ((local_14[1] != 0) && ((uint)local_14[1] < 0x100000)) {\n            local_18 = malloc(local_14[1]);\n            iVar1 = read_n(0,local_18,local_14[1]);\n            if (iVar1 != local_14[1]) goto LAB_0001144b;\n            iVar1 = parse_pkk(local_18,local_14[1]);\n            local_14[2] = iVar1;\n            if (local_14[2] == 0) goto LAB_0001144b;\n            local_10 = local_10 + local_14[1];\n          }\n          iVar1 = read_n(0,&local_1c,4);\n          if ((iVar1 == 4) && (local_1c == -0x447a58e4)) {\n            local_10 = local_10 + 4;\n            iVar1 = read_n(0,&local_1e,2);\n            if (iVar1 == 2) {\n              local_10 = local_10 + 2;\n              *(undefined2 *)(local_14 + 3) = local_1e;\n              iVar1 = read_n(0,&local_1c,4);\n              if ((iVar1 == 4) && (local_1c == -0x40102217)) {\n                local_10 = local_10 + 4;\n                iVar1 = read_n(0,&local_1e,2);\n                if (iVar1 == 2) {\n                  local_10 = local_10 + 2;\n                  *(undefined2 *)((int)local_14 + 0xe) = local_1e;\n                  if (*(short *)((int)local_14 + 0xe) != 0) {\n                    if (1000 < *(ushort *)((int)local_14 + 0xe)) goto LAB_0001144b;\n                    pvVar2 = malloc((uint)*(ushort *)((int)local_14 + 0xe));\n                    local_14[4] = (int)pvVar2;\n                    uVar3 = read_n(0,local_14[4],*(undefined2 *)((int)local_14 + 0xe));\n                    if (uVar3 != *(ushort *)((int)local_14 + 0xe)) goto LAB_0001144b;\n                    local_10 = local_10 + (uint)*(ushort *)((int)local_14 + 0xe);\n                  }\n                  iVar1 = read_n(0,&local_1c,4);\n                  if (((iVar1 == 4) && (local_1c == -0x5499f510)) &&\n                     (local_10 = local_10 + 4, local_10 == *local_14)) {\n                    return local_14;\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\nLAB_0001144b:\n  cleanup_input(local_14);\n  return (int *)0x0;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "parse_input",
                        "malloc",
                        "read_n",
                        "parse_pkk",
                        "cleanup_input"
                    ],
                    "calling_functions": [
                        "parse_input",
                        "main"
                    ],
                    "defined_in_file": "KPRCA_00012_decompiled.c"
                }
            },
            {
                "func_name": "embed_text",
                "func_c_signature": "undefined4 embed_text(int *param_1,void *param_2,ushort param_3)",
                "decompiled_code": "undefined4 embed_text(int *param_1,void *param_2,ushort param_3) {\n  char cVar1;\n  uint __size;\n  undefined4 uVar2;\n  undefined4 *puVar3;\n  int local_18;\n  int local_14;\n  byte *local_10;\n  \n  if (((param_1 == (int *)0x0) || (param_2 == (void *)0x0)) || (param_1[2] == 0)) {\n    uVar2 = 0xffffffff;\n  }\n  else {\n    local_10 = (byte *)param_1[2];\n    __size = param_3 + 10;\n    if ((uint)(*param_1 * param_1[1] * 3) >> 3 < __size) {\n      uVar2 = 0xffffffff;\n    }\n    else {\n      puVar3 = (undefined4 *)malloc(__size);\n      if (puVar3 == (undefined4 *)0x0) {\n        uVar2 = 0xffffffff;\n      }\n      else {\n        *puVar3 = 0xb58333c6;\n        *(ushort *)(puVar3 + 1) = param_3;\n        memcpy((void *)((int)puVar3 + 6),param_2,(uint)param_3);\n        *(undefined4 *)((int)(void *)((int)puVar3 + 6) + (uint)param_3) = 0x507a018;\n        for (local_14 = 0; local_14 < (int)__size; local_14 = local_14 + 1) {\n          cVar1 = *(char *)((int)puVar3 + local_14);\n          for (local_18 = 1; local_18 < 9; local_18 = local_18 + 1) {\n            if (((int)(char)*local_10 & 1U) != ((int)cVar1 >> (8U - (char)local_18 & 0x1f) & 1U)) {\n              if (((int)(char)*local_10 & 1U) == 0) {\n                *local_10 = *local_10 | 1;\n              }\n              else {\n                *local_10 = *local_10 & 0xfe;\n              }\n            }\n            local_10 = local_10 + 1;\n          }\n        }\n        uVar2 = 0;\n      }\n    }\n  }\n  return uVar2;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "embed_text",
                        "malloc",
                        "memcpy"
                    ],
                    "calling_functions": [
                        "embed_text",
                        "main"
                    ],
                    "defined_in_file": "KPRCA_00012_decompiled.c"
                }
            },
            {
                "func_name": "recover_byte",
                "func_c_signature": "byte recover_byte(byte **param_1)",
                "decompiled_code": "byte recover_byte(byte **param_1) {\n  byte local_9;\n  int local_8;\n  \n  local_9 = 0;\n  for (local_8 = 0; local_8 < 8; local_8 = local_8 + 1) {\n    local_9 = local_9 << 1 | **param_1 & 1;\n    *param_1 = *param_1 + 1;\n  }\n  return local_9;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "recover_byte"
                    ],
                    "calling_functions": [
                        "recover_byte",
                        "extract_text"
                    ],
                    "defined_in_file": "KPRCA_00012_decompiled.c"
                }
            },
            {
                "func_name": "extract_text",
                "func_c_signature": "undefined4 extract_text(int param_1,int param_2)",
                "decompiled_code": "undefined4 extract_text(int param_1,int param_2) {\n  undefined4 uVar1;\n  undefined4 local_14;\n  byte local_f;\n  ushort local_e;\n  uint local_c;\n  int local_8;\n  \n  if (((param_1 == 0) || (param_2 == 0)) || (*(int *)(param_1 + 8) == 0)) {\n    uVar1 = 0xffffffff;\n  }\n  else {\n    local_c = 0;\n    local_14 = *(undefined4 *)(param_1 + 8);\n    for (local_8 = 0; local_8 < 4; local_8 = local_8 + 1) {\n      local_f = recover_byte(&local_14);\n      local_c = local_c | (uint)local_f << ((byte)(local_8 << 3) & 0x1f);\n    }\n    if (local_c == 0xb58333c6) {\n      for (local_8 = 0; local_8 < 2; local_8 = local_8 + 1) {\n        local_f = recover_byte(&local_14);\n        local_e = local_e | (ushort)local_f << ((byte)(local_8 << 3) & 0x1f);\n      }\n      for (local_8 = 0; local_8 < (short)local_e; local_8 = local_8 + 1) {\n        local_f = recover_byte(&local_14);\n        *(byte *)(local_8 + param_2) = local_f;\n      }\n      local_c = 0;\n      for (local_8 = 0; local_8 < 4; local_8 = local_8 + 1) {\n        local_f = recover_byte(&local_14);\n        local_c = local_c | (uint)local_f << ((byte)(local_8 << 3) & 0x1f);\n      }\n      if (local_c == 0x507a018) {\n        uVar1 = 0;\n      }\n      else {\n        uVar1 = 0xffffffff;\n      }\n    }\n    else {\n      uVar1 = 0xffffffff;\n    }\n  }\n  return uVar1;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "extract_text",
                        "recover_byte"
                    ],
                    "calling_functions": [
                        "extract_text",
                        "main"
                    ],
                    "defined_in_file": "KPRCA_00012_decompiled.c"
                }
            },
            {
                "func_name": "main",
                "func_c_signature": "undefined4 main(void)",
                "decompiled_code": "undefined4 main(void) {\n  undefined4 uVar1;\n  int iVar2;\n  undefined4 local_404;\n  undefined local_400 [1000];\n  void *local_18;\n  int local_14;\n  undefined *local_10;\n  \n  local_10 = &stack0x00000004;\n  local_14 = parse_input();\n  if (local_14 == 0) {\n    printf(\"[ERROR] Failed to parse input.\\n\");\n    uVar1 = 0xffffffff;\n  }\n  else {\n    if (*(short *)(local_14 + 0xc) == 0x1337) {\n      iVar2 = embed_text(*(undefined4 *)(local_14 + 8),*(undefined4 *)(local_14 + 0x10),\n                         *(undefined2 *)(local_14 + 0xe));\n      if (iVar2 == 0) {\n        local_18 = (void *)output_pkk(*(undefined4 *)(local_14 + 8),&local_404);\n        if (local_18 != (void *)0x0) {\n          transmit(1,local_18,local_404,0);\n          free(local_18);\n        }\n      }\n      else {\n        printf(\"[ERROR] Failed to embed your message.\\n\");\n      }\n    }\n    else if (*(short *)(local_14 + 0xc) == 0x7331) {\n      iVar2 = extract_text(*(undefined4 *)(local_14 + 8),local_400);\n      if (iVar2 == 0) {\n        printf(\"Secret Text: %s\\n\",local_400);\n      }\n      else {\n        printf(\"[ERROR] Failed to extract the message.\\n\");\n      }\n    }\n    else {\n      printf(\"[ERROR] Invalid mode.\\n\");\n    }\n    cleanup_input(local_14);\n    uVar1 = 0;\n  }\n  return uVar1;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "main",
                        "parse_input",
                        "printf",
                        "embed_text",
                        "output_pkk",
                        "transmit",
                        "free",
                        "extract_text",
                        "cleanup_input"
                    ],
                    "calling_functions": [
                        "main",
                        "_start"
                    ],
                    "defined_in_file": "KPRCA_00012_decompiled.c"
                }
            }
        ],
        "pkk.c": [
            {
                "func_name": "skip_whitespace",
                "func_c_signature": "char * skip_whitespace(char *param_1,int param_2)",
                "decompiled_code": "char * skip_whitespace(char *param_1,int param_2) {\n  for (; ((((*param_1 == '\\n' || (*param_1 == '\\r')) || (*param_1 == ' ')) || (*param_1 == '\\t')) &&\n         (param_2 != 0)); param_2 = param_2 + -1) {\n    param_1 = param_1 + 1;\n  }\n  return param_1;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "skip_whitespace"
                    ],
                    "calling_functions": [
                        "skip_whitespace",
                        "parse_pkk"
                    ],
                    "defined_in_file": "KPRCA_00012_decompiled.c"
                }
            },
            {
                "func_name": "parse_pkk",
                "func_c_signature": "uint * parse_pkk(char *param_1,int param_2)",
                "decompiled_code": "uint * parse_pkk(char *param_1,int param_2) {\n  int iVar1;\n  ulong uVar2;\n  void *pvVar3;\n  char *local_20;\n  ulong local_1c;\n  ulong local_18;\n  undefined4 local_14;\n  uint *local_10;\n  \n  local_14 = 0;\n  local_20 = param_1;\n  local_10 = (uint *)0x0;\n  if (((param_1 != (char *)0x0) && (local_10 = (uint *)malloc(0xc), local_10 != (uint *)0x0)) &&\n     (iVar1 = memcmp(local_20,&DAT_00014098,3), iVar1 == 0)) {\n    local_20 = local_20 + 3;\n    local_20 = (char *)skip_whitespace(local_20,param_2 + -3);\n    if (local_20 < param_1 + param_2) {\n      while (*local_20 == '#') {\n        for (; (*local_20 != '\\n' && (local_20 < param_1 + param_2)); local_20 = local_20 + 1) {\n        }\n      }\n      if (local_20 < param_1 + param_2) {\n        local_18 = strtoul(local_20,&local_20,10);\n        local_1c = strtoul(local_20,&local_20,10);\n        local_20 = (char *)skip_whitespace(local_20,param_1 + (param_2 - (int)local_20));\n        uVar2 = strtoul(local_20,&local_20,10);\n        if (uVar2 == 0xff) {\n          local_20 = local_20 + 1;\n          local_10 = (uint *)malloc(0xc);\n          *local_10 = local_1c;\n          local_10[1] = local_18;\n          if ((2 < (uint)((0xffffffff / (ulonglong)local_1c) / (ulonglong)local_18)) &&\n             (local_20 + local_1c * local_18 * 3 <= param_1 + param_2)) {\n            pvVar3 = malloc(local_1c * local_18 * 3);\n            local_10[2] = (uint)pvVar3;\n            if (local_10[2] != 0) {\n              memcpy((void *)local_10[2],local_20,local_1c * local_18 * 3);\n              return local_10;\n            }\n          }\n        }\n      }\n    }\n  }\n  free_pkk(local_10);\n  return (uint *)0x0;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "parse_pkk",
                        "malloc",
                        "memcmp",
                        "skip_whitespace",
                        "strtoul",
                        "memcpy",
                        "free_pkk"
                    ],
                    "calling_functions": [
                        "parse_input",
                        "parse_pkk"
                    ],
                    "defined_in_file": "KPRCA_00012_decompiled.c"
                }
            },
            {
                "func_name": "output_pkk",
                "func_c_signature": "char * output_pkk(int *param_1,int *param_2)",
                "decompiled_code": "char * output_pkk(int *param_1,int *param_2) {\n  size_t __size;\n  char *__dest;\n  int iVar1;\n  uint local_14;\n  char *local_10;\n  \n  __size = *param_1 * param_1[1] * 3 + 0x3a;\n  __dest = (char *)malloc(__size);\n  if (__dest != (char *)0x0) {\n    memset(__dest,0,__size);\n    strcpy(__dest,\"PK\\n\");\n    iVar1 = sprintf(__dest + 3,\"%d %d\\n255\\n\",param_1[1],*param_1);\n    if (iVar1 != -1) {\n      local_10 = __dest + 3 + iVar1;\n      for (local_14 = 0; local_14 < (uint)(param_1[1] * *param_1); local_14 = local_14 + 1) {\n        *local_10 = *(char *)(local_14 * 3 + param_1[2]);\n        local_10[1] = *(char *)(local_14 * 3 + param_1[2] + 1);\n        local_10[2] = *(char *)(local_14 * 3 + param_1[2] + 2);\n        local_10 = local_10 + 3;\n      }\n      *param_2 = (int)local_10 - (int)__dest;\n      return __dest;\n    }\n  }\n  if (__dest != (char *)0x0) {\n    free(__dest);\n  }\n  *param_2 = 0;\n  return (char *)0x0;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "output_pkk",
                        "malloc",
                        "memset",
                        "strcpy",
                        "sprintf",
                        "free"
                    ],
                    "calling_functions": [
                        "main",
                        "output_pkk"
                    ],
                    "defined_in_file": "KPRCA_00012_decompiled.c"
                }
            },
            {
                "func_name": "free_pkk",
                "func_c_signature": "void free_pkk(void *param_1)",
                "decompiled_code": "void free_pkk(void *param_1) {\n  if (param_1 != (void *)0x0) {\n    if (*(int *)((int)param_1 + 8) != 0) {\n      free(*(void **)((int)param_1 + 8));\n    }\n    free(param_1);\n  }\n  return;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "free_pkk",
                        "free"
                    ],
                    "calling_functions": [
                        "cleanup_input",
                        "parse_pkk",
                        "free_pkk"
                    ],
                    "defined_in_file": "KPRCA_00012_decompiled.c"
                }
            }
        ]
    }
}