{
    "file": "chroot",
    "decompiled_code": {
        "chroot.c": [
            {
                "func_name": "uid_unset",
                "func_c_signature": "bool uid_unset(int param_1)",
                "decompiled_code": "bool uid_unset(int param_1) {\n  return param_1 == -1;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "uid_unset"
                    ],
                    "calling_functions": [
                        "uid_unset",
                        "main"
                    ],
                    "defined_in_file": "chroot_decompiled.c"
                }
            },
            {
                "func_name": "gid_unset",
                "func_c_signature": "bool gid_unset(int param_1)",
                "decompiled_code": "bool gid_unset(int param_1) {\n  return param_1 == -1;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "gid_unset"
                    ],
                    "calling_functions": [
                        "gid_unset",
                        "main"
                    ],
                    "defined_in_file": "chroot_decompiled.c"
                }
            },
            {
                "func_name": "parse_additional_groups",
                "func_c_signature": "int parse_additional_groups(undefined8 param_1,long *param_2,long *param_3,char param_4)",
                "decompiled_code": "int parse_additional_groups(undefined8 param_1,long *param_2,long *param_3,char param_4) {\n  ushort *puVar1;\n  byte bVar2;\n  int iVar3;\n  ushort **ppuVar4;\n  group *pgVar5;\n  undefined8 uVar6;\n  int *piVar7;\n  undefined8 uVar8;\n  long in_FS_OFFSET;\n  int local_7c;\n  long local_68;\n  ulong local_60;\n  long local_58;\n  long local_50;\n  char *local_48;\n  group *local_40;\n  char *local_38;\n  undefined8 local_30;\n  undefined8 local_28;\n  long local_20;\n  \n  local_20 = *(long *)(in_FS_OFFSET + 0x28);\n  local_58 = 0;\n  local_68 = 0;\n  local_50 = 0;\n  local_38 = (char *)xstrdup(param_1);\n  local_7c = 0;\n  local_48 = strtok(local_38,\",\");\n  while (local_48 != (char *)0x0) {\n    iVar3 = xstrtoumax(local_48,0,10,&local_60,&DAT_001015ac);\n    if ((iVar3 == 0) && (local_60 < 0x100000000)) {\n      while( true ) {\n        ppuVar4 = __ctype_b_loc();\n        puVar1 = *ppuVar4;\n        bVar2 = to_uchar((int)*local_48);\n        if ((puVar1[bVar2] & 0x2000) == 0) break;\n        local_48 = local_48 + 1;\n      }\n      if ((*local_48 != '+') && (pgVar5 = getgrnam(local_48), pgVar5 != (group *)0x0)) {\n        local_60 = (ulong)pgVar5->gr_gid;\n      }\n      local_40 = (group *)0x1;\n    }\n    else {\n      local_40 = getgrnam(local_48);\n      if (local_40 != (group *)0x0) {\n        local_60 = (ulong)local_40->gr_gid;\n      }\n    }\n    if (local_40 == (group *)0x0) {\n      local_7c = -1;\n      if (param_4 == '\\0') break;\n      uVar8 = quote(local_48);\n      uVar6 = gettext(\"invalid group %s\");\n      piVar7 = __errno_location();\n      local_30 = uVar6;\n      error(0,*piVar7,uVar6,uVar8);\n    }\n    else {\n      if (local_50 == local_68) {\n        local_58 = xpalloc(local_58,&local_68,1,0xffffffffffffffff,4);\n      }\n      *(int *)(local_58 + local_50 * 4) = (int)local_60;\n      local_50 = local_50 + 1;\n    }\n    local_48 = strtok((char *)0x0,\",\");\n  }\n  if ((local_7c == 0) && (local_50 == 0)) {\n    if (param_4 != '\\0') {\n      uVar8 = quote(param_1);\n      local_28 = gettext(\"invalid group list %s\");\n      error(0,0,local_28,uVar8);\n    }\n    local_7c = -1;\n  }\n  *param_2 = local_58;\n  if (local_7c == 0) {\n    *param_3 = local_50;\n  }\n  free(local_38);\n  if (local_20 == *(long *)(in_FS_OFFSET + 0x28)) {\n    return local_7c;\n  }\n                    /* WARNING: Subroutine does not return */\n  __stack_chk_fail();\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "parse_additional_groups",
                        "xstrdup",
                        "strtok",
                        "xstrtoumax",
                        "__ctype_b_loc",
                        "to_uchar",
                        "getgrnam",
                        "quote",
                        "gettext",
                        "__errno_location",
                        "error",
                        "xpalloc",
                        "free",
                        "__stack_chk_fail"
                    ],
                    "calling_functions": [
                        "parse_additional_groups",
                        "main"
                    ],
                    "defined_in_file": "chroot_decompiled.c"
                }
            },
            {
                "func_name": "is_root",
                "func_c_signature": "undefined is_root(char *param_1)",
                "decompiled_code": "undefined is_root(char *param_1) {\n  char cVar1;\n  undefined uVar2;\n  char *__ptr;\n  \n  __ptr = canonicalize_file_name(param_1);\n  if (__ptr != (char *)0x0) {\n    cVar1 = streq(&DAT_00101634,__ptr);\n    if (cVar1 != '\\0') {\n      uVar2 = 1;\n      goto LAB_0010063e;\n    }\n  }\n  uVar2 = 0;\nLAB_0010063e:\n  free(__ptr);\n  return uVar2;\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "is_root",
                        "canonicalize_file_name",
                        "streq",
                        "free"
                    ],
                    "calling_functions": [
                        "is_root",
                        "main"
                    ],
                    "defined_in_file": "chroot_decompiled.c"
                }
            },
            {
                "func_name": "usage",
                "func_c_signature": "void usage(int param_1)",
                "decompiled_code": "void usage(int param_1) {\n  FILE *pFVar1;\n  char *pcVar2;\n  undefined8 uVar3;\n  \n  uVar3 = _program_name;\n  if (param_1 == 0) {\n    pcVar2 = (char *)gettext(\"Usage: %s [OPTION]... NEWROOT [COMMAND [ARG]...]\\n\");\n    printf(pcVar2,uVar3);\n    pFVar1 = _stdout;\n    pcVar2 = (char *)gettext(\"Run COMMAND with root directory set to NEWROOT.\\n\\n\");\n    fputs_unlocked(pcVar2,pFVar1);\n    pFVar1 = _stdout;\n    pcVar2 = (char *)gettext(\n                            \"      --groups=G_LIST        specify supplementary groups as g1,g2,..,gN\\n\"\n                            );\n    fputs_unlocked(pcVar2,pFVar1);\n    pFVar1 = _stdout;\n    pcVar2 = (char *)gettext(\n                            \"      --userspec=USER:GROUP  specify user and group (ID or name) to use\\n\"\n                            );\n    fputs_unlocked(pcVar2,pFVar1);\n    uVar3 = quotearg_style(4,&DAT_00101634);\n    pcVar2 = (char *)gettext(\"      --skip-chdir           do not change working directory to %s\\n\")\n    ;\n    printf(pcVar2,uVar3);\n    pFVar1 = _stdout;\n    pcVar2 = (char *)gettext(\"      --help        display this help and exit\\n\");\n    fputs_unlocked(pcVar2,pFVar1);\n    pFVar1 = _stdout;\n    pcVar2 = (char *)gettext(\"      --version     output version information and exit\\n\");\n    fputs_unlocked(pcVar2,pFVar1);\n    pFVar1 = _stdout;\n    pcVar2 = (char *)gettext(\n                            \"\\nIf no command is given, run \\'\\\"$SHELL\\\" -i\\' (default: \\'/bin/sh -i\\').\\n\"\n                            );\n    fputs_unlocked(pcVar2,pFVar1);\n    emit_exec_status(\"chroot\");\n    emit_ancillary_info(\"chroot\");\n  }\n  else {\n    pcVar2 = (char *)gettext(\"Try \\'%s --help\\' for more information.\\n\");\n    fprintf(_stderr,pcVar2,uVar3);\n  }\n                    /* WARNING: Subroutine does not return */\n  exit(param_1);\n}",
                "globals": [],
                "externs": [
                    "group"
                ],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "usage",
                        "gettext",
                        "printf",
                        "fputs_unlocked",
                        "group",
                        "quotearg_style",
                        "emit_exec_status",
                        "emit_ancillary_info",
                        "fprintf",
                        "exit"
                    ],
                    "calling_functions": [
                        "usage",
                        "main"
                    ],
                    "defined_in_file": "chroot_decompiled.c"
                }
            },
            {
                "func_name": "main",
                "func_c_signature": "undefined4 main(int param_1,char **param_2)",
                "decompiled_code": "undefined4 main(int param_1,char **param_2) {\n  bool bVar1;\n  __uid_t _Var2;\n  char cVar3;\n  int iVar4;\n  undefined4 uVar5;\n  undefined8 uVar6;\n  undefined8 uVar7;\n  int *piVar8;\n  char *pcVar9;\n  long in_FS_OFFSET;\n  char **local_178;\n  __uid_t local_160;\n  __gid_t local_15c;\n  int local_158;\n  undefined4 local_154;\n  int local_150;\n  undefined4 local_14c;\n  int local_148;\n  undefined4 local_144;\n  undefined4 local_140;\n  undefined4 local_13c;\n  undefined4 local_138;\n  undefined4 local_134;\n  undefined4 local_130;\n  int local_12c;\n  undefined4 local_128;\n  int local_124;\n  undefined4 local_120;\n  undefined4 local_11c;\n  undefined4 local_118;\n  int local_114;\n  undefined4 local_110;\n  int local_10c;\n  undefined4 local_108;\n  int local_104;\n  undefined4 local_100;\n  int local_fc;\n  undefined4 local_f8;\n  int local_f4;\n  undefined4 local_f0;\n  int local_ec;\n  __gid_t *local_e8;\n  size_t local_e0;\n  __gid_t *local_d8;\n  char *local_d0;\n  char *local_c8;\n  char *local_c0;\n  char *local_b8;\n  __gid_t *local_b0;\n  char *local_a8;\n  undefined8 local_a0;\n  passwd *local_98;\n  long local_90;\n  passwd *local_88;\n  size_t local_80;\n  undefined8 local_78;\n  undefined8 local_70;\n  undefined8 local_68;\n  undefined8 local_60;\n  undefined *local_58;\n  undefined8 local_50;\n  undefined8 local_48;\n  undefined8 local_40;\n  undefined8 local_38;\n  undefined8 local_30;\n  undefined8 local_28;\n  long local_20;\n  \n  local_20 = *(long *)(in_FS_OFFSET + 0x28);\n  local_d0 = (char *)0x0;\n  local_c8 = (char *)0x0;\n  local_c0 = (char *)0x0;\n  bVar1 = false;\n  local_160 = 0xffffffff;\n  local_15c = 0xffffffff;\n  local_e8 = (__gid_t *)0x0;\n  local_e0 = 0;\n  set_program_name(*param_2);\n  setlocale(6,\"\");\n  bindtextdomain(\"coreutils\",\"/usr/local/share/locale\");\n  textdomain(\"coreutils\");\n  initialize_exit_failure(0x7d);\n  atexit((__func *)&close_stdout);\nLAB_00100a48:\n  local_158 = getopt_long(param_1,param_2,&DAT_001018a9,long_opts,0);\n  if (local_158 != -1) {\n    if (local_158 == 0x102) {\n      bVar1 = true;\n      goto LAB_00100a48;\n    }\n    if (local_158 < 0x103) {\n      if (local_158 == 0x101) {\n        local_d0 = _optarg;\n        local_80 = strlen(_optarg);\n        if ((local_80 != 0) && (local_d0[local_80 - 1] == ':')) {\n          local_d0[local_80 - 1] = '\\0';\n        }\n        goto LAB_00100a48;\n      }\n      if (0x101 < local_158) goto LAB_00100a3d;\n      if (local_158 == 0x100) {\n        local_c0 = _optarg;\n        goto LAB_00100a48;\n      }\n      if (local_158 < 0x101) {\n        if (local_158 == -0x83) {\nLAB_001009e2:\n          uVar6 = proper_name_lite(\"Roland McGrath\",\"Roland McGrath\");\n          version_etc(_stdout,\"chroot\",\"GNU coreutils\",_Version,uVar6,0);\n                    /* WARNING: Subroutine does not return */\n          exit(0);\n        }\n        if (local_158 == -0x82) {\n          usage(0);\n          goto LAB_001009e2;\n        }\n      }\n    }\nLAB_00100a3d:\n    usage(0x7d);\n    goto LAB_00100a48;\n  }\n  if (param_1 <= _optind) {\n    local_78 = gettext(\"missing operand\");\n    local_140 = 0;\n    local_13c = 0;\n    error(0,0,local_78);\n    usage(0x7d);\n  }\n  local_a8 = param_2[_optind];\n  cVar3 = is_root(local_a8);\n  if ((cVar3 != '\\x01') && (bVar1)) {\n    uVar6 = quotearg_style(4,&DAT_00101634);\n    local_70 = gettext(\"option --skip-chdir only permitted if NEWROOT is old %s\");\n    local_138 = 0;\n    local_134 = 0;\n    error(0,0,local_70,uVar6);\n    usage(0x7d);\n  }\n  if (cVar3 != '\\x01') {\n    if (local_d0 != (char *)0x0) {\n      local_a0 = parse_user_spec(local_d0,&local_160,&local_15c,0,0);\n    }\n    cVar3 = uid_unset(local_160);\n    if ((cVar3 != '\\x01') &&\n       (((local_c0 == (char *)0x0 || (cVar3 = gid_unset(local_15c), cVar3 != '\\0')) &&\n        (local_98 = getpwuid(local_160), local_98 != (passwd *)0x0)))) {\n      cVar3 = gid_unset(local_15c);\n      if (cVar3 != '\\0') {\n        local_15c = local_98->pw_gid;\n      }\n      local_c8 = local_98->pw_name;\n    }\n    if ((local_c0 == (char *)0x0) || (*local_c0 == '\\0')) {\n      if (((local_c0 == (char *)0x0) &&\n          ((cVar3 = gid_unset(local_15c), cVar3 != '\\x01' && (local_c8 != (char *)0x0)))) &&\n         (local_150 = xgetgroups(local_c8,local_15c,&local_e8), 0 < local_150)) {\n        local_e0 = (size_t)local_150;\n      }\n    }\n    else {\n      local_154 = parse_additional_groups(local_c0,&local_e8,&local_e0,0);\n    }\n  }\n  iVar4 = chroot(local_a8);\n  if (iVar4 != 0) {\n    uVar6 = quotearg_style(4,local_a8);\n    uVar7 = gettext(\"cannot change root directory to %s\");\n    piVar8 = __errno_location();\n    local_12c = *piVar8;\n    local_130 = 0x7d;\n    local_68 = uVar7;\n    error(0x7d,local_12c,uVar7,uVar6);\n  }\n  if ((!bVar1) && (iVar4 = chdir(\"/\"), iVar4 != 0)) {\n    uVar6 = gettext(\"cannot chdir to root directory\");\n    piVar8 = __errno_location();\n    local_124 = *piVar8;\n    local_128 = 0x7d;\n    local_60 = uVar6;\n    error(0x7d,local_124,uVar6);\n  }\n  if (param_1 == _optind + 1) {\n    local_b8 = getenv(\"SHELL\");\n    if (local_b8 == (char *)0x0) {\n      local_b8 = (char *)bad_cast(\"/bin/sh\");\n    }\n    *param_2 = local_b8;\n    pcVar9 = (char *)bad_cast(&DAT_0010194d);\n    param_2[1] = pcVar9;\n    param_2[2] = (char *)0x0;\n    local_178 = param_2;\n  }\n  else {\n    local_178 = param_2 + (long)_optind + 1;\n  }\n  if ((local_d0 != (char *)0x0) &&\n     (local_90 = parse_user_spec_warn(local_d0,&local_160,&local_15c,0,0,&local_d8), local_90 != 0))\n  {\n    if ((char)local_d8 == '\\0') {\n      local_14c = 0x7d;\n    }\n    else {\n      local_14c = 0;\n    }\n    local_11c = 0;\n    local_58 = &DAT_00101950;\n    local_120 = local_14c;\n    error(local_14c,0,&DAT_00101950,local_90);\n  }\n  cVar3 = uid_unset(local_160);\n  if ((cVar3 != '\\x01') &&\n     ((local_c0 == (char *)0x0 || (cVar3 = gid_unset(local_15c), cVar3 != '\\0')))) {\n    local_88 = getpwuid(local_160);\n    if (local_88 == (passwd *)0x0) {\n      cVar3 = gid_unset(local_15c);\n      _Var2 = local_160;\n      if (cVar3 != '\\0') {\n        uVar6 = gettext(\"no group specified for unknown uid: %ju\");\n        piVar8 = __errno_location();\n        local_114 = *piVar8;\n        local_118 = 0x7d;\n        local_50 = uVar6;\n        error(0x7d,local_114,uVar6,_Var2);\n      }\n    }\n    else {\n      cVar3 = gid_unset(local_15c);\n      if (cVar3 != '\\0') {\n        local_15c = local_88->pw_gid;\n      }\n      local_c8 = local_88->pw_name;\n    }\n  }\n  local_b0 = local_e8;\n  local_d8 = (__gid_t *)0x0;\n  if ((local_c0 == (char *)0x0) || (*local_c0 == '\\0')) {\n    if ((local_c0 == (char *)0x0) &&\n       ((cVar3 = gid_unset(local_15c), cVar3 != '\\x01' && (local_c8 != (char *)0x0)))) {\n      local_148 = xgetgroups(local_c8,local_15c,&local_d8);\n      if (local_148 < 1) {\n        if (local_e0 != 0) goto LAB_00101196;\n        uVar6 = gettext(\"failed to get supplemental groups\");\n        piVar8 = __errno_location();\n        local_10c = *piVar8;\n        local_110 = 0x7d;\n        local_48 = uVar6;\n        error(0x7d,local_10c,uVar6);\n      }\n      local_e0 = (size_t)local_148;\n      local_b0 = local_d8;\n    }\n  }\n  else {\n    iVar4 = parse_additional_groups(local_c0,&local_d8,&local_e0,local_e0 == 0);\n    if (iVar4 == 0) {\n      local_b0 = local_d8;\n    }\n    else if (local_e0 == 0) {\n      uVar5 = 0x7d;\n      goto LAB_001013c2;\n    }\n  }\nLAB_00101196:\n  cVar3 = uid_unset(local_160);\n  if (((cVar3 != '\\x01') || (local_c0 != (char *)0x0)) &&\n     (iVar4 = setgroups(local_e0,local_b0), iVar4 != 0)) {\n    uVar6 = gettext(\"failed to set supplemental groups\");\n    piVar8 = __errno_location();\n    local_104 = *piVar8;\n    local_108 = 0x7d;\n    local_40 = uVar6;\n    error(0x7d,local_104,uVar6);\n  }\n  free(local_d8);\n  free(local_e8);\n  cVar3 = gid_unset(local_15c);\n  if ((cVar3 != '\\x01') && (iVar4 = setgid(local_15c), iVar4 != 0)) {\n    uVar6 = gettext(\"failed to set group-ID\");\n    piVar8 = __errno_location();\n    local_fc = *piVar8;\n    local_100 = 0x7d;\n    local_38 = uVar6;\n    error(0x7d,local_fc,uVar6);\n  }\n  cVar3 = uid_unset(local_160);\n  if ((cVar3 != '\\x01') && (iVar4 = setuid(local_160), iVar4 != 0)) {\n    uVar6 = gettext(\"failed to set user-ID\");\n    piVar8 = __errno_location();\n    local_f4 = *piVar8;\n    local_f8 = 0x7d;\n    local_30 = uVar6;\n    error(0x7d,local_f4,uVar6);\n  }\n  execvp(*local_178,local_178);\n  piVar8 = __errno_location();\n  if (*piVar8 == 2) {\n    local_144 = 0x7f;\n  }\n  else {\n    local_144 = 0x7e;\n  }\n  uVar6 = quote(*local_178);\n  uVar7 = gettext(\"failed to run command %s\");\n  piVar8 = __errno_location();\n  local_ec = *piVar8;\n  local_f0 = 0;\n  local_28 = uVar7;\n  error(0,local_ec,uVar7,uVar6);\n  uVar5 = local_144;\nLAB_001013c2:\n  if (local_20 == *(long *)(in_FS_OFFSET + 0x28)) {\n    return uVar5;\n  }\n                    /* WARNING: Subroutine does not return */\n  __stack_chk_fail();\n}",
                "globals": [],
                "externs": [],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "main",
                        "set_program_name",
                        "setlocale",
                        "bindtextdomain",
                        "textdomain",
                        "initialize_exit_failure",
                        "atexit",
                        "getopt_long",
                        "strlen",
                        "proper_name_lite",
                        "version_etc",
                        "exit",
                        "usage",
                        "gettext",
                        "error",
                        "is_root",
                        "quotearg_style",
                        "parse_user_spec",
                        "uid_unset",
                        "gid_unset",
                        "getpwuid",
                        "xgetgroups",
                        "parse_additional_groups",
                        "chroot",
                        "__errno_location",
                        "chdir",
                        "getenv",
                        "bad_cast",
                        "parse_user_spec_warn",
                        "setgroups",
                        "free",
                        "setgid",
                        "setuid",
                        "execvp",
                        "quote",
                        "__stack_chk_fail"
                    ],
                    "calling_functions": [
                        "main"
                    ],
                    "defined_in_file": "chroot_decompiled.c"
                }
            },
            {
                "func_name": "setgroups",
                "func_c_signature": "int setgroups(size_t __n,__gid_t *__groups)",
                "decompiled_code": "int setgroups(size_t __n,__gid_t *__groups) {\n                    /* WARNING: Bad instruction - Truncating control flow here */\n  halt_baddata();\n}",
                "globals": [],
                "externs": [
                    "halt_baddata"
                ],
                "types": [],
                "includes": [],
                "dependencies": {
                    "called_functions": [
                        "setgroups",
                        "halt_baddata"
                    ],
                    "calling_functions": [
                        "main",
                        "setgroups"
                    ],
                    "defined_in_file": "chroot_decompiled.c"
                }
            }
        ]
    }
}